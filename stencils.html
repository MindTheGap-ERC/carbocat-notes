<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>CarboKitten</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="light.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
<script>
// ScrollSpy snippet from Bramus Van Damme (https://www.bram.us/)
// MIT License.
window.addEventListener('DOMContentLoaded', () => {
	const observer = new IntersectionObserver(entries => {
		entries.forEach(entry => {
			const id = entry.target.getAttribute('id');
      const nav = document.querySelector(`nav li a[href="#${id}"]`)
      if (nav) {
        if (entry.intersectionRatio > 0) {
          nav.parentElement.classList.add('active');
        } else {
          nav.parentElement.classList.remove('active');
			} }
		});
	});

	// Track all sections that have an `id` applied
	document.querySelectorAll('section[id]').forEach((section) => {
		observer.observe(section);
	});
});

function openTab(evt, cityName) {
  // Declare all variables
  var i, tabcontent, tablinks;

  // Get all elements with class="tabcontent" and hide them
  tabcontent = document.getElementsByClassName("tab");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Get all elements with class="tablinks" and remove the class "active"
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  // Show the current tab, and add an "active" class to the button that opened the tab
  document.getElementById(cityName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">CarboKitten</h1>
<p class="subtitle">stencil operations in Julia</p>
</header>

<div class="row">
<div class="col-3 col-s-6" id="contents">
<ul>
<li><a href="bosscher-1992.html"></a></li>
<li><a href="carbocat.html">CarboCAT in Julia</a></li>
<li><a href="carbocat-transport.html">Sediment Transport</a></li>
<li><a href="daisy-world.html">reading notes on Wood’s 2008
review</a></li>
<li><a href="index.html">project notes</a></li>
<li><a href="intro-to-julia.html"></a></li>
<li><a href="random-fields.html"></a></li>
<li><a href="stencils.html">stencil operations in Julia</a></li>
<li><a href="utility.html">utility functions</a></li>
</ul>
</div>
<div class="col-6 col-s-9" id="main">
<section id="stencil-operations" class="level1">
<h1>Stencil operations</h1>
<p>A <em>stencil</em> is the common term for computing many-to-one
operations on grids. Examples of applications are:</p>
<ul>
<li>Finite difference schemes</li>
<li>Finite Impulse Response (FIR) filters</li>
<li>Convolutions (encompassing the previous two)</li>
<li>Cellular Automata</li>
</ul>
<p>Note that for larger convolution kernels, it is often more efficient
to perform convolutions in the Fourier domain. On the matter of
performance: stencil operations are the textbook example for
computations that perform really well on GPUs.</p>
<section id="boundary-types" class="level2">
<h2>Boundary types</h2>
<p>One thing to be mindful of is the treatment of box boundaries. I
define three <em>traits</em> here. These are types that are defined with
the single goal of using the dispatch mechanism in Julia to select the
right methods for us. Boundaries can be <em>periodic</em>,
<em>reflective</em> or <em>constant</em> to some value.</p>
<div class="named-code-block">
<div class="code-block-title">
«boundary-trait»
</div>
<div class="sourceCode" id="cb1"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">abstract type</span> Boundary{dim} <span class="kw">end</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Reflected{dim}       <span class="op">&lt;:</span><span class="dt"> Boundary{dim} </span><span class="kw">end</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Periodic{dim}        <span class="op">&lt;:</span><span class="dt"> Boundary{dim} </span><span class="kw">end</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Constant{dim, value} <span class="op">&lt;:</span><span class="dt"> Boundary{dim} </span><span class="kw">end</span></span></code></pre></div>
</div>
<p>Now we can use these traits to define three methods for indexing on
an offset from some index that is assumed to be within bounds.</p>
<div class="named-code-block">
<div class="code-block-title">
«spec»
</div>
<div class="sourceCode" id="cb2"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@testset</span> <span class="st">&quot;offset_value&quot;</span> <span class="cf">begin</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@test</span> <span class="fu">CartesianIndex</span>(<span class="fl">1</span>, <span class="fl">1</span>) <span class="op">==</span> <span class="fu">offset_index</span>(Reflected{<span class="fl">2</span>}, (<span class="fl">3</span>, <span class="fl">3</span>), <span class="fu">CartesianIndex</span>(<span class="fl">1</span>, <span class="fl">1</span>), <span class="fu">CartesianIndex</span>(<span class="fl">0</span>, <span class="fl">0</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
</div>
<div class="named-code-block">
<div class="code-block-title">
«offset-indexing»
</div>
<div class="sourceCode" id="cb3"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">offset_index</span>(<span class="op">::</span><span class="dt">Type{Periodic{dim}}</span>, shape<span class="op">::</span><span class="dt">NTuple{dim,Int}</span>, i<span class="op">::</span><span class="dt">CartesianIndex</span>, Δi<span class="op">::</span><span class="dt">CartesianIndex</span>) <span class="kw">where</span> {dim}</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CartesianIndex</span>(<span class="fu">mod1</span>.(<span class="fu">Tuple</span>(i <span class="op">+</span> Δi), shape)<span class="op">...</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">offset_index</span>(<span class="op">::</span><span class="dt">Type{Reflected{dim}}</span>, shape<span class="op">::</span><span class="dt">NTuple{dim, Int}</span>, i<span class="op">::</span><span class="dt">CartesianIndex</span>, Δi<span class="op">::</span><span class="dt">CartesianIndex</span>) <span class="kw">where</span> {dim}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clip</span>(i, a, b) <span class="op">=</span> (i <span class="op">&lt;</span> a ? a <span class="op">+</span> a <span class="op">-</span> i <span class="op">:</span> (i <span class="op">&gt;</span> b ? b <span class="op">+</span> b <span class="op">-</span> i <span class="op">:</span> i))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CartesianIndex</span>(<span class="fu">clip</span>.(<span class="fu">Tuple</span>(i <span class="op">+</span> Δi), <span class="fu">ones</span>(<span class="dt">Int</span>, dim), shape)<span class="op">...</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">offset_index</span>(<span class="op">::</span><span class="dt">Type{Constant{dim, value}}</span>, shape<span class="op">::</span><span class="dt">NTuple{dim, Int}</span>, i<span class="op">::</span><span class="dt">CartesianIndex</span>, Δi<span class="op">::</span><span class="dt">CartesianIndex</span>) <span class="kw">where</span> {dim, value}</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> i <span class="op">+</span> Δi</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all</span>(<span class="fu">checkindex</span>.(<span class="dt">Bool</span>, <span class="fu">range</span>.(<span class="fl">1</span>, shape), <span class="fu">Tuple</span>(j))) ? j <span class="op">:</span> <span class="cn">nothing</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">offset_value</span>(BT<span class="op">::</span><span class="dt">Type{B}</span>, z<span class="op">::</span><span class="dt">AbstractArray</span>, i<span class="op">::</span><span class="dt">CartesianIndex</span>, Δi<span class="op">::</span><span class="dt">CartesianIndex</span>) <span class="kw">where</span> {dim, B <span class="op">&lt;:</span><span class="dt"> Boundary{dim}</span>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    z[<span class="fu">offset_index</span>(BT, <span class="fu">size</span>(z), i, Δi)]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">offset_value</span>(<span class="op">::</span><span class="dt">Type{Constant{dim, value}}</span>, z<span class="op">::</span><span class="dt">AbstractArray</span>, i<span class="op">::</span><span class="dt">CartesianIndex</span>, Δi<span class="op">::</span><span class="dt">CartesianIndex</span>) <span class="kw">where</span> {dim, value}</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> i <span class="op">+</span> Δi</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">checkbounds</span>(<span class="dt">Bool</span>, z, j) ? z[j] <span class="op">:</span> value)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
</section>
<section id="stencil-implementation" class="level2">
<h2>Stencil implementation</h2>
<p>Using these helper functions we can now define a <em>stencil</em>
operation. Given the boundary trait, a stencil size and a response
function, we can transform an array to a next generation.</p>
<div class="named-code-block">
<div class="code-block-title">
«stencil-operation»
</div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">stencil</span>(<span class="op">::</span><span class="dt">Type{T}</span>, <span class="op">::</span><span class="dt">Type{BT}</span>, n<span class="op">::</span><span class="dt">NTuple{dim,Int}</span>, f<span class="op">::</span><span class="dt">Function</span>) <span class="kw">where</span> {T, dim, BT <span class="op">&lt;:</span><span class="dt"> Boundary{dim}</span>}</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> n <span class="op">.÷</span> <span class="fl">2</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    stencil_shape <span class="op">=</span> <span class="fu">range</span>.(<span class="op">.-</span>m, m)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    stencil <span class="op">=</span> <span class="fu">zeros</span>(T, n)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>(z_in<span class="op">::</span><span class="dt">AbstractArray{T, dim}</span>, z_out<span class="op">::</span><span class="dt">AbstractArray{T, dim}</span>, args<span class="op">...</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@assert</span> (<span class="fu">size</span>(z_in) <span class="op">==</span> <span class="fu">size</span>(z_out)) <span class="st">&quot;sizes of arrays need to be equal&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        shape <span class="op">=</span> <span class="fu">size</span>(z_in)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">CartesianIndices</span>(shape)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (k, Δi) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">CartesianIndices</span>(stencil_shape))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                stencil[k] <span class="op">=</span> <span class="fu">offset_value</span>(BT, z_in, i, Δi)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            z_out[i] <span class="op">=</span> <span class="fu">f</span>(stencil, args<span class="op">...</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convolution</span>(<span class="op">::</span><span class="dt">Type{B}</span>, kernel<span class="op">::</span><span class="dt">Array{T, dim}</span>) <span class="kw">where</span> { dim, T, B <span class="op">&lt;:</span><span class="dt"> Boundary{dim} </span>}</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stencil</span>(T, B, <span class="fu">size</span>(kernel), s <span class="op">-&gt;</span> <span class="fu">sum</span>(s <span class="op">.*</span> kernel))</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<p>More efficient implementations are imaginable. For instance we could
use normal unchecked indexing for most of the array, and only use the
<code>offset_value</code> function when we really need it. Another
optimisation could be to generate parts of the inner loop, and/or do the
outer loop in parallel.</p>
<p>We will now test this function first on an Elementary CA (ECA),
Conway’s Game of Life, and a convolution.</p>
<details>
<summary>
Stencil module
</summary>
<div class="named-code-block">
<div class="code-block-title">
file:src/Stencil.jl
</div>
<div class="sourceCode" id="cb5"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> Stencil</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> Boundary, Reflected, Periodic, Constant, stencil, convolution, offset_index, offset_value</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>boundary<span class="op">-</span>trait<span class="op">&gt;&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>offset<span class="op">-</span>indexing<span class="op">&gt;&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>stencil<span class="op">-</span>operation<span class="op">&gt;&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
</details>
</section>
<section id="elementary-cellular-automata" class="level2">
<h2>Elementary Cellular Automata</h2>
<p>An Elementary Cellular Automata is a one-dimensional CA with two
states. Every next generation depends on the direct neighbourhood of
three cells. Since there are <span class="math inline">\(2^3 =
8\)</span> patterns and two outcomes for every pattern, there are <span
class="math inline">\(2^8 = 256\)</span> possible ECA.</p>
<div class="named-code-block">
<div class="code-block-title">
file:src/examples/eca.jl
</div>
<div class="sourceCode" id="cb6"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MindTheGap.Stencil</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GnuplotLite</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rule</span>(i<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="kw">function</span> (x<span class="op">::</span><span class="dt">AbstractVector{T}</span>) <span class="kw">where</span> T <span class="op">&lt;:</span><span class="dt"> Integer</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> x[<span class="fl">1</span>]<span class="op">*</span><span class="fl">4</span> <span class="op">+</span> x[<span class="fl">2</span>]<span class="op">*</span><span class="fl">2</span> <span class="op">+</span> x[<span class="fl">3</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    i <span class="op">&amp;</span> (<span class="fl">1</span> <span class="op">&lt;&lt;</span> d) <span class="op">==</span> <span class="fl">0</span> ? <span class="fl">0</span> <span class="op">:</span> <span class="fl">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">eca</span>(r<span class="op">::</span><span class="dt">Int</span>, n<span class="op">::</span><span class="dt">Int</span>, iter<span class="op">::</span><span class="dt">Int</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Int}</span>(<span class="cn">undef</span>, n, iter)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    y[<span class="op">:</span>, <span class="fl">1</span>] <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, n)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    stencil_op <span class="op">=</span> <span class="fu">stencil</span>(<span class="dt">Int</span>, Periodic{<span class="fl">1</span>}, (<span class="fl">3</span>,), <span class="fu">rule</span>(r))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>iter</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stencil_op</span>(<span class="fu">view</span>(y, <span class="op">:</span>, i<span class="op">-</span><span class="fl">1</span>), <span class="fu">view</span>(y, <span class="op">:</span>, i))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    y</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>eca<span class="op">-</span>plot<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
<div class="tabs">
<div class="buttons">
<button id="rule-18-button" class="tablink" onclick="openTab(event, 'rule-18')">rule-18</button>
<button id="rule-30-button" class="tablink" onclick="openTab(event, 'rule-30')">rule-30</button>
<button id="rule-60-button" class="tablink" onclick="openTab(event, 'rule-60')">rule-60</button>
<button id="rule-110-button" class="tablink" onclick="openTab(event, 'rule-110')">rule-110</button>
</div>
<div id="rule-18" class="tab" title="Rule 18">
<p><img src="fig/rule18.svg" /></p>
</div>
<div id="rule-30" class="tab" title="Rule 30">
<p><img src="fig/rule30.svg" /></p>
</div>
<div id="rule-60" class="tab" title="Rule 60">
<p><img src="fig/rule60.svg" /></p>
</div>
<div id="rule-110" class="tab" title="Rule 110">
<p><img src="fig/rule110.svg" /></p>
</div>
<script>document.getElementById("rule-18-button").click();</script>
</div>
<p>Even these one-dimensional CA show highly complex behaviour. For
instance, it has been shown that rule 110 is Turing complete.</p>
<details>
<summary>
Plotting code
</summary>
<div class="named-code-block">
<div class="code-block-title">
«eca-plot»
</div>
<div class="sourceCode" id="cb7"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_eca</span>(output<span class="op">::</span><span class="dt">String</span>, r<span class="op">::</span><span class="dt">Int</span>, n<span class="op">::</span><span class="dt">Int</span>, iter<span class="op">::</span><span class="dt">Int</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    plot_width <span class="op">=</span> <span class="fl">700</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    plot_height <span class="op">=</span> plot_width <span class="op">*</span> iter <span class="op">÷</span> n <span class="op">+</span> <span class="fl">100</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnuplot</span>() <span class="cf">do</span> g</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        g <span class="op">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set term svg size </span><span class="sc">$</span>(plot_width)<span class="st">, </span><span class="sc">$</span>(plot_height)<span class="st">&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set output &#39;</span><span class="sc">$</span>(output)<span class="st">&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;data&quot;</span> <span class="op">=&gt;</span> (x<span class="op">=</span><span class="fl">0</span><span class="op">:</span>n<span class="op">-</span><span class="fl">1</span>, y<span class="op">=</span><span class="fl">0</span><span class="op">:</span>iter<span class="op">-</span><span class="fl">1</span>, z<span class="op">=</span><span class="fu">eca</span>(r, n, iter)<span class="ch">&#39;)) |&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set title &#39;rule </span><span class="sc">$</span>(r)<span class="st">&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set xrange [0:</span><span class="sc">$</span>(n)<span class="st">]; set yrange [</span><span class="sc">$</span>(iter)<span class="st">:0] reverse&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set xlabel &#39;space&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set ylabel &#39;iterations&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set size ratio -1&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;unset colorbox; set palette gray&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;plot \$data nonuniform matrix u (\$1+0.5):(\$2+0.5):3 with image&quot;</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div class="named-code-block">
<div class="code-block-title">
«build-eca-plots»
</div>
<pre class="make"><code>.RECIPEPREFIX = &gt;
.PHONY: all

fig := docs/fig

all: $(fig)/rule18.svg $(fig)/rule30.svg $(fig)/rule60.svg $(fig)/rule110.svg

$(fig)/rule%.svg: src/examples/eca.jl
&gt; @mkdir -p $(@D)
&gt; julia --project=. -e &#39;include(&quot;./src/examples/eca.jl&quot;); plot_eca(&quot;$@&quot;, $(*F), 256, 100)&#39;</code></pre>
</div>
</details>
</section>
<section id="game-of-life" class="level2">
<h2>Game of Life</h2>
<p>Perhaps the most famous CA is Conway’s Game of Life. This is a
two-dimensional two-state (dead/alive) CA, with the following rules: a
cell is alive in the next generation if it is alive and has two
neighbours or if it has three neighbours; in all other cases the cell is
dead.</p>
<div class="named-code-block">
<div class="code-block-title">
«game-of-life-rules»
</div>
<div class="sourceCode" id="cb9"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;x is a 3x3 region around the cell at x[2,2].&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span>(x) <span class="op">=</span> <span class="kw">let</span> c <span class="op">=</span> x[<span class="fl">2</span>, <span class="fl">2</span>], s <span class="op">=</span> <span class="fu">sum</span>(x) <span class="op">-</span> c</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    c <span class="op">&amp;&amp;</span> s <span class="op">==</span> <span class="fl">2</span> <span class="op">||</span> s <span class="op">==</span> <span class="fl">3</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div class="named-code-block">
<div class="code-block-title">
file:src/examples/game-of-life.jl
</div>
<div class="sourceCode" id="cb10"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MindTheGap.Stencil</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GnuplotLite</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">game_of_life</span>(w, h)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="fu">rand</span>(<span class="dt">Bool</span>, (w, h))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    y2 <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Bool}</span>(<span class="cn">undef</span>, w, h)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>game<span class="op">-</span>of<span class="op">-</span>life<span class="op">-</span>rules<span class="op">&gt;&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    op <span class="op">=</span> <span class="fu">stencil</span>(<span class="dt">Bool</span>, Periodic{<span class="fl">2</span>}, (<span class="fl">3</span>, <span class="fl">3</span>), rules)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Channel</span>() <span class="cf">do</span> ch</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">put!</span>(ch, y1)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="cn">true</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">op</span>(y1, y2)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            (y1, y2) <span class="op">=</span> (y2, y1)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">put!</span>(ch, y1)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>life<span class="op">-</span>plot<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
<p><img src="fig/game-of-life.svg" /></p>
<details>
<summary>
Plotting code
</summary>
<div class="named-code-block">
<div class="code-block-title">
«life-plot»
</div>
<div class="sourceCode" id="cb11"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_life</span>(output<span class="op">::</span><span class="dt">String</span>, w<span class="op">::</span><span class="dt">Int</span>, h<span class="op">::</span><span class="dt">Int</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    (z, _) <span class="op">=</span> <span class="bu">Iterators</span>.<span class="fu">peel</span>(<span class="bu">Iterators</span>.<span class="fu">drop</span>(<span class="fu">game_of_life</span>(w, h), <span class="fl">50</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    plot_width <span class="op">=</span> <span class="fl">700</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    plot_height <span class="op">=</span> plot_width <span class="op">*</span> h <span class="op">÷</span> w <span class="op">+</span> <span class="fl">100</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnuplot</span>() <span class="cf">do</span> g</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        g <span class="op">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set term svg size </span><span class="sc">$</span>(plot_width)<span class="st">, </span><span class="sc">$</span>(plot_height)<span class="st">&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set output &#39;</span><span class="sc">$</span>(output)<span class="st">&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;data&quot;</span> <span class="op">=&gt;</span> <span class="fu">Matrix</span><span class="dt">{Int}</span>(z<span class="op">&#39;</span>)) <span class="op">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set title &#39;game of life&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set xrange [0:</span><span class="sc">$</span>(w)<span class="st">]; set yrange [0:</span><span class="sc">$</span>(h)<span class="st">]&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set size ratio -1&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;unset colorbox; set palette gray negative&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;plot \$data matrix u (\$1+0.5):(\$2+0.5):3 with image pixels&quot;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div class="named-code-block">
<div class="code-block-title">
«make-life-plot»
</div>
<pre class="make"><code>.RECIPEPREFIX = &gt;

docs/fig/game-of-life.svg: src/examples/game-of-life.jl
&gt; @mkdir -p $(@D)
&gt; julia --project=. -e &#39;include(&quot;$&lt;&quot;); plot_life(&quot;$@&quot;, 128, 128)&#39;</code></pre>
</div>
</details>
</section>
<section id="testing-boundaries-with-a-convolution" class="level2">
<h2>Testing boundaries with a convolution</h2>
<p>To test the different boundary types, lets try the following setup.
We take a 16x16 image with all zeros except the bottom left gets a value
of 1 and the top right pixel gets a value of 2. Now convolve with a
Gaussian and see what happens. For the constant boundary, I’ve set the
value to 0.1, to see the effect.</p>
<p><img src="fig/boundary_types.svg" /></p>
<p>Notice, that for the periodic boundaries, the bottom left and top
right are neighbouring. So there the two pixels appear as a single peak.
In the reflected case we see a clear distinction between the two
corners.</p>
<details>
<summary>
Source code for plotting boundary types
</summary>
<div class="named-code-block">
<div class="code-block-title">
file:src/examples/convolution.jl
</div>
<div class="sourceCode" id="cb13"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MindTheGap.Stencil</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GnuplotLite</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_boundary_types</span>(output<span class="op">::</span><span class="dt">String</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fl">16</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    y0 <span class="op">=</span> <span class="fu">zeros</span>(<span class="dt">Float64</span>, n, n)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    y0[<span class="fl">1</span>, <span class="fl">1</span>] <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    y0[n, n] <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">collect</span>(<span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">0.25</span><span class="op">:</span><span class="fl">2</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">-</span>(x<span class="op">.^</span><span class="fl">2</span> <span class="op">.+</span> x<span class="op">&#39;.^</span><span class="fl">2</span>))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    k <span class="op">./=</span> <span class="fu">sum</span>(k)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    y_periodic <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n, n)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convolution</span>(Periodic{<span class="fl">2</span>}, k)(y0, y_periodic)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    y_reflected <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n, n)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convolution</span>(Reflected{<span class="fl">2</span>}, k)(y0, y_reflected)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    y_constant <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n, n)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convolution</span>(Constant{<span class="fl">2</span>, <span class="fl">0.1</span>}, k)(y0, y_constant)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnuplot</span>() <span class="cf">do</span> g</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        g <span class="op">|&gt;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;load &#39;data/moreland.pal&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;periodic&quot;</span> <span class="op">=&gt;</span> y_periodic) <span class="op">|&gt;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;reflected&quot;</span> <span class="op">=&gt;</span> y_reflected) <span class="op">|&gt;</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;constant&quot;</span> <span class="op">=&gt;</span> y_constant) <span class="op">|&gt;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set term svg size 700, 300&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set output &#39;</span><span class="sc">$</span>(output)<span class="st">&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set multiplot layout 1, 3&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set size square&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set xrange [0:</span><span class="sc">$</span>(n)<span class="st">]; set yrange [0:</span><span class="sc">$</span>(n)<span class="st">]&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;unset colorbox&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># send(&quot;set colorbox horiz user origin graph 0,screen .04 size graph 1,screen .04&quot;) |&gt;</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;unset xtics; unset ytics&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set title &#39;periodic&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;plot \$periodic matrix u (\$1+0.5):(\$2+0.5):3 t&#39;&#39; w image&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set title &#39;reflected&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;plot \$reflected matrix u (\$1+0.5):(\$2+0.5):3 t&#39;&#39; w image&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;set title &#39;constant (0.1)&#39;&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;plot \$constant matrix u (\$1+0.5):(\$2+0.5):3 t&#39;&#39; w image&quot;</span>) <span class="op">|&gt;</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">send</span>(<span class="st">&quot;unset multiplot&quot;</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div class="named-code-block">
<div class="code-block-title">
«make-bounds-plot»
</div>
<pre class="make"><code>.RECIPEPREFIX = &gt;

docs/fig/boundary_types.svg: src/examples/convolution.jl
&gt; @mkdir -p $(@D)
&gt; julia --project=. -e &#39;include(&quot;$&lt;&quot;); plot_boundary_types(&quot;$@&quot;)&#39;</code></pre>
</div>
</details>
</section>
</section>
</div>

<div id="menu" class="col-3 col-s-3 menu"><nav id="TOC" role="doc-toc">
<ul>
<li><a href="#stencil-operations" id="toc-stencil-operations">Stencil
operations</a>
<ul>
<li><a href="#boundary-types" id="toc-boundary-types">Boundary
types</a></li>
<li><a href="#stencil-implementation"
id="toc-stencil-implementation">Stencil implementation</a></li>
<li><a href="#elementary-cellular-automata"
id="toc-elementary-cellular-automata">Elementary Cellular
Automata</a></li>
<li><a href="#game-of-life" id="toc-game-of-life">Game of Life</a></li>
<li><a href="#testing-boundaries-with-a-convolution"
id="toc-testing-boundaries-with-a-convolution">Testing boundaries with a
convolution</a></li>
</ul></li>
</ul>
</nav></div>
</div>

<div class="footer">
</div>

</body>
</html>
